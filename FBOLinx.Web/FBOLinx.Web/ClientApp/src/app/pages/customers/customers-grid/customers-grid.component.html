<div #customerTableContainer class="customers-grid">
    <div class="container-fluid">
        <div class="row">
            <div *ngIf="anySelected()" class="col-2">
                <mat-form-field>
                    <mat-select (selectionChange)="bulkMarginTemplateUpdate($event)"
                                placeholder="Bulk Update Margin Template">
                        <mat-option *ngFor="let pricingTemplate of pricingTemplatesData"
                                    [value]="pricingTemplate">
                            {{ pricingTemplate.name }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div *ngIf="customersDataSource" class="col-6">
                <app-table-global-search
                    [matDataSource]="customersDataSource"
                    placeholder="Search by Company, Tail, etc."
                ></app-table-global-search>
            </div>
            <div class="col-2">
                <mat-form-field>
                    <mat-select (selectionChange)="customerFilterTypeChanged()"
                                [(ngModel)]="customerFilterType"
                                placeholder="Search Within">
                        <mat-option [value]="0">
                            All Customers
                        </mat-option>
                        <mat-option [value]="1">
                            Customers Needing Attention
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div *ngIf="anySelected()" class="col-2 bulk-action-btn">
                <div>
                    <button (click)="exportCustomersToExcel()"
                            [view]="'accent'"
                            ni-button>
                        Export Selected
                    </button>
                </div>
            </div>
            <div class="export-import-menu">
                <div class="actions-menu">
                    <button [matMenuTriggerFor]="gridActions" mat-icon-button>
                        <mat-icon aria-hidden="true" class="mat-icon material-icons" role="img">more_vert</mat-icon>
                    </button>
                    <mat-menu #gridActions="matMenu" class="switch-nested-menu-left-arrows" xPosition="before">
                        <button (click)="launchImporter()" [ngClass]="{ disabled: !LICENSE_KEY }" mat-menu-item>
                            Import
                        </button>
                        <button [matMenuTriggerFor]="exportActions" mat-menu-item>Export</button>
                        <button (click)="openSettings()" mat-menu-item>Settings</button>
                    </mat-menu>
                    <mat-menu #exportActions="matMenu" xPosition="before">
                        <button (click)="exportCustomersToExcel()" mat-menu-item>Export Customers</button>
                        <button (click)="exportCustomerAircraftToExcel()" mat-menu-item>Export Aircraft</button>
                    </mat-menu>
                </div>
            </div>
        </div>
    </div>
    <div class="w-100 table-container" style="overflow-x:auto">
        <table #customerTable
               [dataSource]="customersDataSource"
               class="col-md-12 mb-0"
               mat-table
               matSort>
            <ng-container matColumnDef="selectAll">
                <th *matHeaderCellDef mat-header-cell>
                    <input (change)="selectAction()"
                           [(ngModel)]="selectAll"
                           class="checkboxHeight"
                           id="a"
                           style="position: absolute; margin-top: 8px;"
                           type="checkbox"/>
                    <div for="a" style="margin-left: 25px; margin-top: 0px;">
                        <div>Select</div>
                        <div>All</div>
                    </div>
                </th>
                <td *matCellDef="let customer" clickStopPropagation mat-cell>
                    <input (change)="selectUnique()"
                           [(ngModel)]="customer.selectAll"
                           class="checkboxHeight"
                           type="checkbox"
                           value="{{ customer.selectAll }}"/>
                </td>
            </ng-container>

            <ng-container matColumnDef="needsAttention">
                <th *matHeaderCellDef class="text-left"
                    mat-header-cell
                    mat-sort-header
                >
                    <div class="">Needs Attention</div>
                </th>
                <td *matCellDef="let customer" mat-cell>
                    <div>
                        <ni-badge *ngIf="customer.needsAttention"
                                  [arrow]="'right'"
                                  [borderRadius]="false"
                                  [color]="'warning'"
                                  matTooltip="{{customer.needsAttentionReason}}"
                                  matTooltipPosition="after">
                            Needs Attention
                        </ni-badge>
                        <a *ngIf="
                            !customer.isFuelerLinxCustomer &&
                            !customer.contactExists
                        "
                           matTooltip="This customer does not have any contacts setup to receive price distribution."
                           matTooltipPosition="after"
                           style="float: right;">
                            <i class="fa fa-warning" style="color: red;"></i>
                        </a>
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="company">
                <th *matHeaderCellDef
                    mat-header-cell
                    mat-sort-header
                >
                    <span>Company</span>
                    <span *ngIf="customersDataSource">
                    <app-table-column-filter [matDataSource]="customersDataSource"
                                             [matSort]="sort"
                                             columnId="company"
                                             propertyName="company"
                    ></app-table-column-filter>
                  </span>
                </th>
                <td *matCellDef="let customer" mat-cell>{{ customer.company }}</td>
            </ng-container>

            <ng-container matColumnDef="customerCompanyTypeName">
                <th *matHeaderCellDef class="overflow-label"
                    mat-header-cell
                    mat-sort-header
                >
                    <div>
                        <div>Customer</div>
                        <div>Type</div>
                    </div>
                    <span *ngIf="customersDataSource">
                  <app-table-column-filter [matDataSource]="customersDataSource"
                                           [matSort]="sort"
                                           columnId="customerCompanyTypeName"
                                           propertyName="customerCompanyTypeName"></app-table-column-filter>
                </span>
                </th>
                <td *matCellDef="let customer" mat-cell>
                    {{ customer.customerCompanyTypeName }}
                </td>
            </ng-container>

            <ng-container matColumnDef="isFuelerLinxCustomer">
                <th *matHeaderCellDef class="overflow-label"
                    mat-header-cell
                    mat-sort-header
                >
                    <div>
                        <div>FuelerLinx</div>
                        <div>Network</div>
                    </div>
                    <span *ngIf="customersDataSource">
                  <app-table-column-filter [columnFormat]="8"
                                           [matDataSource]="customersDataSource"
                                           [matSort]="sort"
                                           columnId="isFuelerLinxCustomer"
                                           propertyName="isFuelerLinxCustomer"></app-table-column-filter>
                </span>
                </th>
                <td *matCellDef="let customer" mat-cell>
                    {{ customer.isFuelerLinxCustomer ? 'YES' : 'NO' }}
                </td>
            </ng-container>

            <ng-container matColumnDef="certificateTypeDescription">
                <th *matHeaderCellDef class="overflow-label"
                    mat-header-cell
                    mat-sort-header
                >
                    <div>
                        <div>Certificate</div>
                        <div>Type</div>
                    </div>
                    <span *ngIf="customersDataSource">
                  <app-table-column-filter [matDataSource]="customersDataSource"
                                           [matSort]="sort"
                                           columnId="certificateTypeDescription"
                                           propertyName="certificateTypeDescription"></app-table-column-filter>
                </span>
                </th>
                <td *matCellDef="let customer" mat-cell>
                    {{ customer.certificateTypeDescription }}
                </td>
            </ng-container>

            <ng-container matColumnDef="pricingTemplateName">
                <th *matHeaderCellDef
                    mat-header-cell
                    mat-sort-header
                >
                    ITP Margin Template
                    <span *ngIf="customersDataSource">
                  <app-table-column-filter [matDataSource]="customersDataSource"
                                           [matSort]="sort"
                                           columnId="pricingTemplateName"
                                           propertyName="pricingTemplateName"></app-table-column-filter>
                </span>
                </th>
                <td *matCellDef="let customer" clickStopPropagation mat-cell>
                    <select (ngModelChange)="onMarginChange($event, customer)"
                            [(ngModel)]="customer.pricingTemplateId"
                            class="dropdownHeight"
                            id="pricingtemplates"
                            name="ddlPricingTemplate">
                        <option *ngFor="let pricingTemplate of pricingTemplatesData"
                                value="{{ pricingTemplate.oid }}">
                            {{ pricingTemplate.name }}
                        </option>
                    </select>
                </td>
            </ng-container>

            <ng-container matColumnDef="fleetSize">
                <th *matHeaderCellDef class="overflow-label"
                    mat-header-cell
                    mat-sort-header
                >
                    <div>
                        <div>Fleet</div>
                        <div>Size</div>
                    </div>
                    <span *ngIf="customersDataSource">
                  <app-table-column-filter [columnFormat]="1"
                                           [matDataSource]="customersDataSource"
                                           [matSort]="sort"
                                           columnId="fleetSize"
                                           propertyName="fleetSize"></app-table-column-filter>
                </span>
                </th>
                <td *matCellDef="let customer" mat-cell>
                    {{ customer.fleetSize }}
                </td>
            </ng-container>

            <ng-container matColumnDef="delete">
                <th *matHeaderCellDef mat-header-cell>
                    <div class="pull-right">
                        <button (click)="newCustomer()"
                                [view]="'accent'"
                                beforeIcon="fa fa-plus"
                                class="action-btn"
                                ni-button>
                            Add New
                        </button>
                    </div>

                </th>
                <td *matCellDef="let customer" mat-cell>
                    <div class="pull-right">
                        <button (click)="
                            deleteCustomer(customer); $event.stopPropagation()
                        "
                                *ngIf="!customer.isFuelerLinxCustomer"
                                [view]="'error'"
                                beforeIcon="fa fa-trash"
                                ni-button
                                size="small">
                            Delete
                        </button>
                    </div>
                </td>
            </ng-container>

            <tr *matHeaderRowDef="getTableColumns(); sticky: true" mat-header-row></tr>
            <tr (click)="editCustomer(row)"
                *matRowDef="let row; columns: getTableColumns()"
                mat-row></tr>
        </table>
        <mat-paginator (page)="(pageIndex); onPageChanged($event)"
                       [length]="customersData.length"
                       [pageSizeOptions]="[10, 25, 50, 100]"
                       [pageSize]="pageSize"></mat-paginator>
    </div>

</div>


