<ni-card
    *ngIf="currentPrices"
    title="Jet-A"
    bgColor="success"
    headerBgColor="success"
    outline="true"
    theme="tiny"
    [align]="'center'"
    style="position: absolute; top: -100px; right: 30px; min-width: 150px; min-height: 90px;"
>
    <div class="d-flex justify-content-between">
        <h6 class="text-muted mt-0 mb-1 font-weight-normal">Retail:</h6>
        <h6 class="mt-0 mb-1 font-weight-bold">
            <span *ngIf="jetARetailExists()">${{ currentFboPriceJetARetail.price | number: "1.4-4" }}</span>
            <span *ngIf="!jetARetailExists()">Expired</span>
        </h6>
    </div>
    <div class="d-flex justify-content-between">
        <h6 class="text-muted mt-0 mb-1 font-weight-normal">Cost:</h6>
        <h6 class="mt-0 mb-1 font-weight-bold">
            <span *ngIf="jetACostExists()">${{ currentFboPriceJetACost.price | number: "1.4-4" }}</span>
            <span *ngIf="!jetACostExists()">Expired</span>
        </h6>
    </div>
</ni-card>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-4 mt-3">
            <ni-card
                title="Live Pricing"
                subtitle="Costs are always kept confidential"
                bgColor="success"
                headerBgColor="success"
                outline="true"
                theme="small"
                customStyle="min-height: 160px; padding-top: 15px; padding-bottom: 15px;"
            >
                <div
                    *ngIf="currentPrices"
                    class="row"
                >
                    <div class="col-2">
                        <div class="text-center">
                            <div class="h5 mt-0 mb-2">&nbsp;</div>
                            <h4 class="mt-0">
                                <span class="h5 mt-0 text-muted">Jet-A</span>
                            </h4>
                        </div>
                    </div>

                    <div class="col-5">
                        <div class="text-center">
                            <div class="h5 mt-0 mb-2 text-muted">Retail</div>
                            <h4
                                *ngIf="jetARetailExists()"
                                class="mt-0 mb-1"
                            >
                                ${{ currentFboPriceJetARetail.price | number: "1.4-4" }}
                            </h4>
                            <h4
                                *ngIf="!jetARetailExists()"
                                class="font-italic"
                            >
                                Expired
                            </h4>
                            <h6
                                *ngIf="jetARetailExists()"
                                class="expire-date mt-0 mb-2 text-muted"
                            >
                                Expires: {{ currentFboPriceJetARetail.effectiveTo | date }}
                            </h6>
                            <button
                                *ngIf="jetARetailExists()"
                                mat-raised-button
                                class="clear-btn"
                                color="warn"
                                (click)="suspendRetailPricing()"
                            >
                                <span *ngIf="!isLoadingRetail">Clear</span>
                                <mat-icon *ngIf="isLoadingRetail"><mat-spinner diameter="20"></mat-spinner></mat-icon>
                            </button>
                        </div>
                    </div>

                    <div class="col-5">
                        <div class="text-center">
                            <div class="h5 mt-0 mb-2 text-muted">Cost</div>
                            <h4
                                *ngIf="jetACostExists()"
                                class="mt-0 mb-1"
                            >
                                ${{ currentFboPriceJetACost.price | number: "1.4-4" }}
                            </h4>
                            <h4
                                *ngIf="!jetACostExists()"
                                class="font-italic"
                            >
                                Expired
                            </h4>
                            <h6 
                                *ngIf="jetACostExists()"
                                class="expire-date mt-0 mb-2 text-muted">
                                Expires: {{ currentFboPriceJetACost.effectiveTo | date }}
                            </h6>
                            <button
                                *ngIf="jetACostExists()"
                                mat-raised-button
                                class="clear-btn"
                                color="warn"
                                (click)="suspendJetPricing()"
                            >
                                <span *ngIf="!isLoadingCost">Clear</span>
                                <mat-icon *ngIf="isLoadingCost"><mat-spinner diameter="20"></mat-spinner></mat-icon>
                            </button>
                        </div>
                    </div>
                </div>

                <ngx-ui-loader
                    [loaderId]="pricingLoader"
                    bgsPosition="center-center"
                    fgsType="pulse"
                    fgsColor="#81C784"
                    pbColor="#81C784"
                    overlayColor="rgba(0, 0, 0, 0.03)"
                ></ngx-ui-loader>
            </ni-card>
        </div>
        <div class="col-md-8 mt-3">
            <ni-card
                class="mb-0"
                title="Update your pricing here"
                bgColor="dead"
                headerBgColor="dead"
                theme="small"
                outline="true"
                customStyle="min-height: 160px;"
            >
                <div class="row">
                    <div class="col-1 mt-1">
                        <span class="h5 mt-0">Jet-A</span>
                    </div>
                    <div class="col-3 mt-4">
                        <mat-form-field>
                            <input
                                matInput
                                id="idTo"
                                [min]="currentPricingEffectiveFrom"
                                [(ngModel)]="currentPricingEffectiveTo"
                                [matDatepicker]="currentPricingEffectiveToDatePicker"
                                (focus)="currentPricingEffectiveToDatePicker.open()"
                                placeholder="Effective To"
                            />
                            <mat-datepicker-toggle
                                matSuffix
                                [for]="currentPricingEffectiveToDatePicker"
                            ></mat-datepicker-toggle>
                            <mat-datepicker
                                #currentPricingEffectiveToDatePicker
                                disabled="false"
                            ></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="col-3 mt-4">
                        <mat-form-field>
                            <input
                                matInput
                                type="number"
                                step="0.01"
                                title="Your Retail values should be inclusive of all taxes/fees"
                                placeholder="Retail*"
                                [ngModelOptions]="{updateOn: 'blur'}"
                                (click)="$event.target.select()"
                                [ngModel]="jtRetail | number: '1.4-4'"
                                (ngModelChange)="fboPriceRequiresUpdate($event,'JetA Retail')"
                            />
                            <span matPrefix class="prefixDollar">$</span>
                        </mat-form-field>
                    </div>
                    <div class="col-3 mt-4">
                        <mat-form-field>
                            <input
                                matInput
                                type="number"
                                step="0.01"
                                title="Your Cost values should be inclusive of all taxes/fees"
                                placeholder="Cost*"
                                [ngModelOptions]="{updateOn: 'blur'}"
                                (click)="$event.target.select()"
                                [ngModel]="jtCost | number: '1.4-4'"
                                (ngModelChange)="fboPriceRequiresUpdate($event,'JetA Cost')"
                            />
                            <span matPrefix class="prefixDollar">$</span>
                            <span
                                class="fbo-prices-error-msg"
                                *ngIf="priceEntryError.length > 0"
                            >{{ priceEntryError }}</span>
                        </mat-form-field>
                    </div>
                    <div class="col-2 mt-4 pt-2">
                        <div class="text-center">
                            <button
                                mat-raised-button
                                color="accent"
                                [disabled]="!canUpdatePricing()"
                                class="mr-1"
                                (click)="updatePricing()"
                            >
                                Update Pricing
                            </button>
                        </div>
                    </div>
                </div>
            </ni-card>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col-md-4">
            <ni-card
                title="Add On Margin"
                subtitle="This margin is applies to all customers"
                bgColor="danger"
                headerBgColor="danger"
                outline="true"
                theme="small"
                [collapsible]="'true'"
                [opened]="TempValueId > 0"
            >
                <div class="row">
                    <div class="col-2">
                        <div class="text-center">
                            <div class="h5 mt-0 mb-2">&nbsp;</div>
                            <h4 class="mt-0">
                                <span class="h5 mt-0 text-muted">Jet-A</span>
                            </h4>
                        </div>
                    </div>

                    <div class="col-5">
                        <div class="text-center">
                            <mat-form-field>
                                <input
                                    matInput
                                    [min]="currentPricingEffectiveFrom"
                                    [(ngModel)]="TempDateFrom"
                                    [matDatepicker]="addOnMarginEffectiveFromDatePicker"
                                    (focus)="addOnMarginEffectiveFromDatePicker.open()"
                                    placeholder="From"
                                />
                                <mat-datepicker-toggle
                                    matSuffix
                                    [for]="addOnMarginEffectiveFromDatePicker"
                                ></mat-datepicker-toggle>
                                <mat-datepicker
                                    #addOnMarginEffectiveFromDatePicker
                                    disabled="false"
                                ></mat-datepicker>
                            </mat-form-field>

                            <mat-form-field>
                                <input
                                    matInput
                                    [min]="TempDateFrom"
                                    [(ngModel)]="TempDateTo"
                                    [matDatepicker]="addOnMarginEffectiveToDatePicker"
                                    (focus)="addOnMarginEffectiveToDatePicker.open()"
                                    placeholder="To"
                                />
                                <mat-datepicker-toggle
                                    matSuffix
                                    [for]="addOnMarginEffectiveToDatePicker"
                                ></mat-datepicker-toggle>
                                <mat-datepicker
                                    #addOnMarginEffectiveToDatePicker
                                    disabled="false"
                                ></mat-datepicker>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="col-5">
                        <div class="d-flex h-100 align-items-end text-center">
                            <mat-form-field class="add-on-margin-input">
                                <input
                                    matInput
                                    type="number"
                                    step="0.01"
                                    placeholder="Margin"
                                    [ngModelOptions]="{updateOn: 'blur'}"
                                    (click)="$event.target.select()"
                                    [ngModel]="TempValueJet | number: '1.4-4'"
                                    (ngModelChange)="marginValueChanged($event)"
                                />
                                <span matPrefix class="prefixDollar bigPrefix">$</span>
                            </mat-form-field>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12 text-right">
                        <button
                            *ngIf="TempValueId"
                            mat-raised-button
                            color="warn"
                            class="mr-3 clear-btn"
                            (click)="clearMargin()"
                            style="min-width: 125px;"
                        >
                            <span *ngIf="!isClearingMargin">Clear Add On</span>
                            <mat-icon *ngIf="isClearingMargin"><mat-spinner diameter="20"></mat-spinner></mat-icon>
                        </button>
                        <button
                            mat-raised-button
                            color="accent"
                            class="mr-1 clear-btn"
                            [disabled]="!canUpdateMargin()"
                            (click)="updateMargin()"
                            style="min-width: 125px;"
                        >
                            <span *ngIf="!isUpdatingMargin">Update Margin</span>
                            <mat-icon *ngIf="isUpdatingMargin"><mat-spinner diameter="20"></mat-spinner></mat-icon>
                        </button>
                    </div>
                </div>
            </ni-card>
        </div>
        <div class="col-md-8">
            <ni-card
                title="Stage Future Prices"
                bgColor="dark"
                headerBgColor="dark"
                outline="true"
                theme="small"
                [collapsible]="'true'"
            >
            </ni-card>
        </div>
    </div>
</div>
