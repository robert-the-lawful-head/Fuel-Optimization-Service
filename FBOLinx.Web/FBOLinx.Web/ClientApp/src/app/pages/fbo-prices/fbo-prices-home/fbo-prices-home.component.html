<div class="container-fluid">
    <div *ngIf="!isCsr" class="d-flex pricing-page justify-content-between">
        <div class="pricing-display-board mt-3">
            <ni-card
                title="Live Pricing"
                subtitle="Costs are always kept confidential"
                bgColor="success"
                headerBgColor="success"
                outline="true"
                theme="small"
                customStyle="min-height: 160px; padding-top: 15px; padding-bottom: 15px;"
            >
                <div
                    *ngIf="currentPrices"
                    class="row"
                >
                    <div class="col-2">
                        <div class="text-center">
                            <div class="h5 mt-0 mb-2">&nbsp;</div>
                            <h4 class="mt-0">
                                <span class="h5 mt-0 text-muted">Jet-A</span>
                            </h4>
                        </div>
                    </div>

                    <div class="col-5">
                        <div class="text-center">
                            <div class="h5 mt-0 mb-2 text-muted">Retail</div>
                            <h4
                                *ngIf="jetARetailExists()"
                                class="mt-0 mb-1"
                            >
                                ${{ currentFboPriceJetARetail.price | number: "1.4-4" }}
                            </h4>
                            <h4
                                *ngIf="!jetARetailExists()"
                                class="font-italic"
                            >
                                Expired
                            </h4>
                            <h6
                                *ngIf="jetARetailExists()"
                                class="expire-date mt-0 mb-2 text-muted"
                            >
                                Expires: {{ currentFboPriceJetARetail.effectiveTo | date }}
                            </h6>
                            <button
                                *ngIf="jetARetailExists()"
                                mat-raised-button
                                class="clear-btn"
                                color="warn"
                                (click)="suspendRetailPricing()"
                            >
                                <span *ngIf="!isLoadingRetail">Clear</span>
                                <mat-icon *ngIf="isLoadingRetail"><mat-spinner diameter="20"></mat-spinner></mat-icon>
                            </button>
                        </div>
                    </div>

                    <div class="col-5">
                        <div class="text-center">
                            <div class="h5 mt-0 mb-2 text-muted">Cost</div>
                            <h4
                                *ngIf="jetACostExists()"
                                class="mt-0 mb-1"
                            >
                                ${{ currentFboPriceJetACost.price | number: "1.4-4" }}
                            </h4>
                            <h4
                                *ngIf="!jetACostExists()"
                                class="font-italic"
                            >
                                Expired
                            </h4>
                            <h6 
                                *ngIf="jetACostExists()"
                                class="expire-date mt-0 mb-2 text-muted">
                                Expires: {{ currentFboPriceJetACost.effectiveTo | date }}
                            </h6>
                            <button
                                *ngIf="jetACostExists()"
                                mat-raised-button
                                class="clear-btn"
                                color="warn"
                                (click)="suspendJetPricing()"
                            >
                                <span *ngIf="!isLoadingCost">Clear</span>
                                <mat-icon *ngIf="isLoadingCost"><mat-spinner diameter="20"></mat-spinner></mat-icon>
                            </button>
                        </div>
                    </div>
                </div>

                <ngx-ui-loader
                    [loaderId]="pricingLoader"
                    bgsPosition="center-center"
                    fgsType="pulse"
                    fgsColor="#81C784"
                    pbColor="#81C784"
                    overlayColor="rgba(0, 0, 0, 0.03)"
                ></ngx-ui-loader>
            </ni-card>
        </div>

        <div class="pricing-update-board" [ngClass]="{ 'mt-3': !layoutChanged, 'mb-3': layoutChanged }">
            <ni-card
                class="mb-0"
                title="Update your pricing here"
                bgColor="dead"
                headerBgColor="dead"
                theme="small"
                outline="true"
                customStyle="min-height: 160px;"
            >
              <div style="position: absolute; right: 10px; top: -30px;">
                <button ni-button
                        size="small"
                        class="mr-1"
                        view="'default'"
                        (click)="editFeesAndTaxes()">
                  Fees &amp; Taxes
                </button>
              </div>

                <div class="row">
                    <div class="col-12">
                        <div class="mt-1 pricing-name">
                            <span class="h5 mt-0">Jet-A</span>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-content-around">
                    <div class="pl-3 pr-2" style="position: relative;">
                        <mat-form-field>
                            <input
                                matInput
                                id="idTo"
                                [min]="currentPricingEffectiveFrom"
                                [(ngModel)]="currentPricingEffectiveTo"
                                [matDatepicker]="currentPricingEffectiveToDatePicker"
                                (focus)="currentPricingEffectiveToDatePicker.open()"
                                placeholder="Expires"
                            />
                            <mat-datepicker-toggle
                                matSuffix
                                [for]="currentPricingEffectiveToDatePicker"
                            ></mat-datepicker-toggle>
                            <mat-datepicker
                                #currentPricingEffectiveToDatePicker
                                disabled="false"
                            ></mat-datepicker>
                        </mat-form-field>

                        <div style="
                            position: absolute;
                            bottom: 20px;
                            left: 50%;
                            "
                        >
                            <button
                                class="tooltip-button"
                                #tooltip="ngbPopover"
                                popoverTitle="Expiration Date"
                                [ngbPopover]="content1"
                                triggers="manual"
                                placement="bottom"
                                (hidden)="tooltipHidden()"
                            ></button>
                            <ng-template #content1>
                                This date controls when your pricing is valid
                                <div class="popover-actions">
                                    <button>Got it</button>
                                </div>
                            </ng-template>
                        </div>
                    </div>
                    <div class="pr-2" style="position: relative;">
                        <mat-form-field>
                            <input
                                matInput
                                type="number"
                                step="0.01"
                                title="Your Retail values should be inclusive of all taxes/fees"
                                placeholder="Retail*"
                                [ngModelOptions]="{updateOn: 'blur'}"
                                (click)="$event.target.select()"
                                [ngModel]="jtRetail | number: '1.4-4'"
                                (ngModelChange)="fboPriceRequiresUpdate($event,'JetA Retail')"
                            />
                            <span matPrefix class="prefixDollar">$</span>
                        </mat-form-field>
                        <div style="
                            position: absolute;
                            right: 0;
                            bottom: 20px;"
                        >
                            <button
                                class="tooltip-button"
                                #tooltip="ngbPopover"
                                popoverTitle="Price/Cost Entry"
                                popoverClass="no-arrow"
                                [ngbPopover]="content2"
                                triggers="manual"
                                placement="bottom"
                                (hidden)="tooltipHidden()"
                            ></button>
                            <ng-template #content2>
                                Enter your current pricing here
                                <div class="popover-actions">
                                    <button>Got it</button>
                                </div>
                            </ng-template>
                        </div>
                    </div>
                    <div class="pr-2">
                        <mat-form-field>
                            <input
                                matInput
                                type="number"
                                step="0.01"
                                title="Your Cost values should be inclusive of all taxes/fees"
                                placeholder="Cost*"
                                [ngModelOptions]="{updateOn: 'blur'}"
                                (click)="$event.target.select()"
                                [ngModel]="jtCost | number: '1.4-4'"
                                (ngModelChange)="fboPriceRequiresUpdate($event,'JetA Cost')"
                            />
                            <span matPrefix class="prefixDollar">$</span>
                            <span
                                class="fbo-prices-error-msg"
                                *ngIf="priceEntryError.length > 0"
                            >{{ priceEntryError }}</span>
                        </mat-form-field>
                    </div>
                    <div class="pt-2">
                        <div class="text-center">
                            <button
                                mat-raised-button
                                color="accent"
                                [disabled]="!canUpdatePricing()"
                                class="mr-1 updateBtn"
                                (click)="updatePricing()"
                            >
                                Update Pricing
                            </button>
                        </div>
                    </div>
                </div>
            </ni-card>
        </div>
    </div>
    <div class="d-flex pricing-page justify-content-between mt-3">
        <div *ngIf="!isCsr" class="add-on-margin-board" [ngClass]="{ 'mt-3': layoutChanged }">
            <ni-card
                title="Add On Margin"
                subtitle="This margin is applies to all customers"
                bgColor="danger"
                headerBgColor="danger"
                outline="true"
                theme="small"
                [collapsible]="'true'"
                [opened]="TempValueId > 0"
            >
                <div class="row">
                    <div class="col-2">
                        <div class="text-center">
                            <div class="h5 mt-0 mb-2">&nbsp;</div>
                            <h4 class="mt-0">
                                <span class="h5 mt-0 text-muted">Jet-A</span>
                            </h4>
                        </div>
                    </div>

                    <div class="col-5">
                        <div class="text-center">
                            <mat-form-field>
                                <input
                                    matInput
                                    [min]="currentPricingEffectiveFrom"
                                    [(ngModel)]="TempDateFrom"
                                    [matDatepicker]="addOnMarginEffectiveFromDatePicker"
                                    (focus)="addOnMarginEffectiveFromDatePicker.open()"
                                    placeholder="From"
                                />
                                <mat-datepicker-toggle
                                    matSuffix
                                    [for]="addOnMarginEffectiveFromDatePicker"
                                ></mat-datepicker-toggle>
                                <mat-datepicker
                                    #addOnMarginEffectiveFromDatePicker
                                    disabled="false"
                                ></mat-datepicker>
                            </mat-form-field>

                            <mat-form-field>
                                <input
                                    matInput
                                    [min]="TempDateFrom"
                                    [(ngModel)]="TempDateTo"
                                    [matDatepicker]="addOnMarginEffectiveToDatePicker"
                                    (focus)="addOnMarginEffectiveToDatePicker.open()"
                                    placeholder="To"
                                />
                                <mat-datepicker-toggle
                                    matSuffix
                                    [for]="addOnMarginEffectiveToDatePicker"
                                ></mat-datepicker-toggle>
                                <mat-datepicker
                                    #addOnMarginEffectiveToDatePicker
                                    disabled="false"
                                ></mat-datepicker>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="col-5">
                        <div class="d-flex h-100 align-items-end text-center">
                            <mat-form-field class="add-on-margin-input">
                                <input
                                    matInput
                                    type="number"
                                    step="0.01"
                                    placeholder="Margin"
                                    [ngModelOptions]="{updateOn: 'blur'}"
                                    (click)="$event.target.select()"
                                    [ngModel]="TempValueJet | number: '1.4-4'"
                                    (ngModelChange)="marginValueChanged($event)"
                                />
                                <span matPrefix class="prefixDollar bigPrefix">$</span>
                            </mat-form-field>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12 text-right">
                        <button
                            *ngIf="TempValueId"
                            mat-raised-button
                            color="warn"
                            class="mr-3 clear-btn"
                            (click)="clearMargin()"
                            style="min-width: 125px;"
                        >
                            <span *ngIf="!isClearingMargin">Clear Add On</span>
                            <mat-icon *ngIf="isClearingMargin"><mat-spinner diameter="20"></mat-spinner></mat-icon>
                        </button>
                        <button
                            mat-raised-button
                            color="accent"
                            class="mr-1 clear-btn"
                            [disabled]="!canUpdateMargin()"
                            (click)="updateMargin()"
                            style="min-width: 125px;"
                        >
                            <span *ngIf="!isUpdatingMargin">Update Margin</span>
                            <mat-icon *ngIf="isUpdatingMargin"><mat-spinner diameter="20"></mat-spinner></mat-icon>
                        </button>
                    </div>
                </div>
            </ni-card>
        </div>

        <!--Tail number price lookup-->

        <div class="pricing-update-board" [ngClass]="{ 'w-full': isCsr }">
            <ni-card
                title="Lookup Price by Tail"
                bgColor="dead"
                headerBgColor="dead"
                theme="small"
                outline="true"
                [collapsible]="!isCsr"
            >
                <div class="d-flex justify-content-around">
                    <div class="pr-2">
                        <mat-form-field>
                            <input
                                matInput
                                placeholder="Tail Number*"
                                [formControl]="tailNumberForLookupControl"
                                aria-label="Aircraft Tail Number"
                                
                            />
                        </mat-form-field>
                    </div>
                    <div class="pr-2">
                      <mat-form-field>
                        <mat-label>Customer</mat-label>
                        <mat-select placeholder="Customer" [(ngModel)]="customerForTailLookup">
                          <mat-option *ngFor="let customer of customersForTail" [value]="customer">
                            {{customer.company}}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div class="pr-2">
                      <mat-form-field>
                        <mat-label>Flight Type</mat-label>
                        <mat-select placeholder="Flight Type" [(ngModel)]="flightTypeClassification">
                          <mat-option *ngFor="let flightType of strictFlightTypeClassificationOptions" [value]="flightType.value">
                            {{flightType.text}}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div class="pr-2">
                      <mat-form-field>
                        <mat-label>Dom. v. Int.</mat-label>
                        <mat-select placeholder="Dom. v. Int." [(ngModel)]="departureType">
                          <mat-option *ngFor="let departureType of strictApplicableTaxFlightOptions" [value]="departureType.value">
                            {{departureType.text}}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div class="pt-2">
                        <div class="text-center">
                            <button
                                mat-raised-button
                                color="accent"
                                class="mr-1 updateBtn"
                                [disabled]="!tailNumber || !customerForTailLookup"
                                (click)="lookupTail()"
                            >
                                Check Pricing
                            </button>
                        </div>
                    </div>
                </div>

                <div *ngIf="tailLookupError" class="h6 mt-0 mb-0 text-danger pl-5">No Tail Price Found!</div>

                <div *ngIf="tailLookupInfo && !tailLookupError">
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-6">                        
                        <div class="tailLookupInfo">
                          <div class="h6 text-muted mt-0 mb-0">Pricing Template: </div>
                          <div class="h6 mt-0 mb-0">{{ tailLookupInfo?.template ? tailLookupInfo.template : 'N/A' }}</div>
                        </div>
                        <div class="tailLookupInfo">
                          <div class="h6 text-muted mt-0 mb-0">Company: </div>
                          <div class="h6 mt-0 mb-0">{{ tailLookupInfo?.company ? tailLookupInfo.company: 'N/A' }}</div>
                        </div>
                        <div class="tailLookupInfo">
                          <div class="h6 text-muted mt-0 mb-0">Make/Model: </div>
                          <div class="h6 mt-0 mb-0">{{ tailLookupInfo?.makeModel ? tailLookupInfo.makeModel : 'N/A' }}</div>
                        </div>
                        <div class="tailLookupInfo">
                          <div class="h6 text-muted mt-0 mb-0">Ramp Fee: </div>
                          <div class="h6 mt-0 mb-0" *ngIf="tailLookupInfo?.rampFee">${{tailLookupInfo?.rampFee.price  | number: "1.2-4" }} waived at {{tailLookupInfo.rampFee.waived | number: "1.0"}} gal.</div>
                          <div class="h6 mt-0 mb-0" *ngIf="!tailLookupInfo?.rampFee">N/A</div>
                        </div>
                        <div class="tailLookupInfo" *ngIf="tailLookupInfo?.rampFee">
                          <div class="h6 text-muted mt-0 mb-0">Ramp Fee Rule: </div>
                          <div class="h6 mt-0 mb-0" *ngIf="tailLookupInfo?.rampFee">{{tailLookupInfo.rampFee.categorizationDescription}}</div>
                        </div>
                      </div>

                      <div class="col-6">
                        <table>
                          <thead>
                            <tr>
                              <th class="pr-4">All-In Price</th>
                              <th class="pr-4">Min. Gal.</th>
                              <th class="pr-4">Max. Gal.</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let price of tailLookupInfo.pricingList">
                              <td>
                                ${{ price.allInPrice | number: "1.4-4" }}
                              </td>
                              <td>
                                {{price.minGallons | number}}
                              </td>
                              <td>
                                {{price.maxGallons | number}}
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                  
                </div>

                <ngx-ui-loader
                    [loaderId]="tailLoader"
                    bgsPosition="center-center"
                    fgsType="fading-circle"
                    fgsColor="#252d47"
                    pbColor="#252d47"
                    overlayColor="rgba(0, 0, 0, 0.06)"
                ></ngx-ui-loader>
            </ni-card>
        </div>
    </div>
</div>
