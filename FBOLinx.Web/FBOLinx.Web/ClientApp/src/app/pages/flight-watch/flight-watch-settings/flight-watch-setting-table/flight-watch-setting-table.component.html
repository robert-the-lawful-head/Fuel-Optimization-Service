<div class="table-header-container">
    <p class="table-header">{{ getSwimDataTypeString() }}</p>
</div>
<div class="table-container">
    <mat-spinner *ngIf="!data"></mat-spinner>
    <table
        mat-table
        [dataSource]="dataSource"
        multiTemplateDataRows
        matSort
        (matSortChange)="sortData($event)"
        [class.hide]="!data"
    >
        <ng-container matColumnDef="expand-icon">
            <th mat-header-cell *matHeaderCellDef aria-label="row actions">
                &nbsp;
            </th>
            <td mat-cell *matCellDef="let element">
                <button
                    mat-icon-button
                    aria-label="expand row"
                    (click)="
                        expandedElement =
                            expandedElement === element.tailNumber ? null : element.tailNumber;
                        $event.stopPropagation()
                    "
                >
                    <mat-icon *ngIf="expandedElement !== element.tailNumber"
                        >keyboard_arrow_down</mat-icon
                    >
                    <mat-icon *ngIf="expandedElement === element.tailNumber"
                        >keyboard_arrow_up</mat-icon
                    >
                </button>
            </td>
        </ng-container>
        <ng-container
            matColumnDef="{{ column }}"
            *ngFor="let column of dataColumnsToDisplay"
        >
            <th
                mat-header-cell
                *matHeaderCellDef
                mat-sort-header="{{ column }}"
            >
                {{ getColumnDisplayString(column) }}
                <span *ngIf="dataSource">
                    <app-table-column-filter
                        [matDataSource]="dataSource"
                        [matSort]="sort"
                        columnId="{{ column }}"
                        propertyName="{{ column }}"
                    ></app-table-column-filter>
                </span>
            </th>
            <td
                mat-cell
                *matCellDef="let element"
            >
                <span class="center-items">
                    <ng-container *ngIf="isFavoriteButtonVisible(column, element)">
                        <app-favorite-icon
                        [favoriteData]="setIsFavoriteProperty(element)"
                        [hasPadding]="false"
                        (favoriteClick)="toogleFavorite(element)"
                        (click)="$event.stopPropagation()"></app-favorite-icon>
                    </ng-container>

                    <ng-container *ngIf="hasIcon(column) && !isFavoriteButtonVisible(column, element)"
                        ><mat-icon [ngStyle]="{ color: getTextColor(element, column) }">{{
                            getIcon(element)
                        }}</mat-icon></ng-container
                    >
                    {{ getColumnData(element, column) }}
                </span>
            </td>
        </ng-container>
        <ng-container matColumnDef="expandedDetail">
            <td
                mat-cell
                *matCellDef="let element"
                [attr.colspan]="allColumnsToDisplay.length"
            >
                <div
                    class="example-element-detail"
                    [@detailExpand]="
                        element.tailNumber == expandedElement ? 'expanded' : 'collapsed'
                    "
                >
                    <div class="example-element-description">
                        <table class="description-table">
                            <tr>
                                <td>
                                    Make/Model:
                                    {{ getMakeModelDisplayString(element) }}
                                </td>
                                <td>Altitude: {{ element.altitude }}</td>
                                <td>
                                    ETA:
                                    {{
                                        element.etaZulu | getTime
                                    }}
                                </td>
                                <td>
                                    {{ getOriginCityLabel() }}:
                                    {{ element.city }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Visit to {{ fbo }} (30 days):
                                    {{ element.visitsToMyFBO }}
                                </td>
                                <td>
                                    Past Arrivals at
                                    {{ icao }} (30 days):
                                    {{ getPastArrivalsValue(element) }}
                                </td>
                                <td>
                                    ATD:
                                    {{
                                        element.atdZulu | getTime
                                    }}
                                </td>
                                <td>
                                    FAA Registered Owner:
                                    {{ element.faaRegisteredOwner }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Fuel Capacity (gal):
                                    {{ element.fuelCapacityGal }}
                                </td>
                                <td>
                                    FuelerLinx ID: {{ element.fuelerlinxID }}
                                </td>
                                <td>
                                    Transaction Status:
                                    {{ element.transactionStatus }}
                                </td>
                                <td>{{ element.phone }}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </td>
        </ng-container>

        <tr
            mat-header-row
            *matHeaderRowDef="allColumnsToDisplay; sticky: true"
        ></tr>
        <tr
            mat-row
            *matRowDef="let element; columns: allColumnsToDisplay"
            class="example-element-row"
            [class.example-expanded-row]="expandedElement === element.tailNumber"
            (click)="
                expandedElement = expandedElement === element.tailNumber ? null : element.tailNumber
            "
        ></tr>
        <tr
            mat-row
            *matRowDef="let row; columns: ['expandedDetail']"
            class="example-detail-row"
        ></tr>
        <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" [attr.colspan]="columns.length">
                {{ getNoDataToDisplayString() }}
            </td>
        </tr>
    </table>
</div>
