<div>
    <mat-form-field class="filter">
        <input (keyup)="applyFilter($event.target.value)" [value]="searchValue" matInput
               placeholder="Search by Group, FBO, User, ...">
        <span matPrefix><i class="fa fa-search"></i></span>
    </mat-form-field>

    <button (click)="mergeGroups()" *ngIf="selectedRows.length > 1" color="warn" mat-flat-button>
        <mat-icon>merge_type</mat-icon>
        Merge Groups
    </button>
</div>

<ejs-grid
    #grid
    (rowDeselected)="rowDeselected()"
    (rowSelected)="rowSelected($event)"
    [allowPaging]='true'
    [childGrid]='childGrid'
    [dataSource]='groupDataSource'
    [pageSettings]='pageSettings'
    [selectionSettings]='selectionOptions'
>
    <e-columns>
        <e-column type='checkbox' width='50'></e-column>
        <e-column field='groupName' headerText='Group'></e-column>
        <e-column>
            <ng-template #template let-data>
                <span [ngClass]="{'good': allChildFbosPricingLive(data.index)}" class="status">
                    {{fbosPricingExpired(data.index)}}
                </span>
            </ng-template>
        </e-column>
        <e-column>
            <ng-template #template let-data>
                <span [ngClass]="{'good': data.needAttentionCustomers == 0 }" class="status">
                    {{data.needAttentionCustomers}} Need Attentions
                </span>
            </ng-template>
        </e-column>
        <e-column field='lastLogin' headerText='Last Login Date'>
            <ng-template #template let-data>
                {{data.lastLogin | date:'medium'}}
            </ng-template>
        </e-column>
        <e-column field='active' headerText='Active'></e-column>
        <e-column width=200>
            <ng-template #headerTemplate let-data>
                <button (click)="addNewGroupOrFbo()" [view]="'accent'" beforeIcon="fa fa-plus" ni-button>Add New
                </button>
            </ng-template>
            <ng-template #template let-data>
                <button [matMenuTriggerFor]="menu" aria-label="Group Actions" clickStopPropagation mat-icon-button>
                    <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                    <button (click)="manageGroup(data)" clickStopPropagation mat-menu-item>
                        <mat-icon>business_center</mat-icon>
                        <span>Manage</span>
                    </button>
                    <button (click)="addNewFbo(data)" clickStopPropagation mat-menu-item>
                        <mat-icon>add</mat-icon>
                        <span>Add FBO</span>
                    </button>
                    <button (click)="deleteGroup(data)" clickStopPropagation mat-menu-item>
                        <mat-icon>delete_forever</mat-icon>
                        <span>Delete Group</span>
                    </button>
                    <button [disabled]="!groupFbos(data.index).length" [matMenuTriggerFor]="fbosMenu" clickStopPropagation
                            mat-menu-item>
                        <span>Delete FBO</span>
                    </button>
                </mat-menu>
                <mat-menu #fbosMenu="matMenu">
                    <button (click)="deleteFbo(fbo)" *ngFor="let fbo of groupFbos(data.index)" clickStopPropagation
                            mat-menu-item>
                        <mat-icon>delete_forever</mat-icon>
                        <span>{{fbo.fbo}}</span>
                    </button>
                </mat-menu>
            </ng-template>
        </e-column>
    </e-columns>
</ejs-grid>

<ng-template #pricingExpiredTemplate let-data>
    <span [ngClass]="{'good': !data.pricingExpired }" class="status">
        {{data.pricingExpired ? 'Expired' : 'Pricing Live'}}
    </span>
</ng-template>

<ng-template #fboManageTemplate let-data>
    <button (click)="manageFBO(data)" [view]="'warning'" beforeIcon="fa fa-briefcase" clickStopPropagation ni-button
            size="small">Manage
    </button>
</ng-template>

<ng-template #needAttentionTemplate let-data>
    <span [ngClass]="{'good': data.needAttentionCustomers == 0 }" class="status">
        {{data.needAttentionCustomers}} Need Attentions
    </span>
</ng-template>

<ng-template #lastLoginTemplate let-data>
    {{data.lastLogin | date:'medium'}}
</ng-template>
