<h1 mat-dialog-title>
    {{title}}<span *ngIf="templateName">: {{templateName}}</span></h1>
<div mat-dialog-content>
    <div class="container-fluid" *ngIf="isSaving">
        <div class="row">
            <div class="col">
                <mat-spinner></mat-spinner>
            </div>
        </div>
    </div>
    <mat-horizontal-stepper [linear]="true" #stepper *ngIf="!isSaving">
        <mat-step [stepControl]="firstFormGroup">
            <form [formGroup]="firstFormGroup">
                <ng-template matStepLabel>Margin Name</ng-template>
                <div class="container-fluid inner-content">
                    <div class="row mt-2 mb-2">
                        <div class="col-8">
                            <mat-form-field>
                                <input matInput autocomplete="off" placeholder="Margin Name" aria-label="Margin Name" formControlName="templateName" [(ngModel)]="templateName">
                            </mat-form-field>
                        </div>
                        <div class="col-4 mt-3">
                            <mat-slide-toggle color="accent" formControlName="templateDefault">Default</mat-slide-toggle>
                        </div>
                    </div>
                </div>
                <div class="text-right mt-2">
                    <button mat-button [mat-dialog-close]="">Cancel</button>
                    <button mat-button matStepperNext>Next</button>
                </div>
            </form>
        </mat-step>
        <mat-step [stepControl]="secondFormGroup">
            <form [formGroup]="secondFormGroup">
                <ng-template matStepLabel>
                    Edit Tiers</ng-template>
                <div class="container-fluid inner-content">
                    <div class="row mb-4 mt-2">
                        <div class="col-3">
                            <mat-form-field class="col-8">
                                <mat-select placeholder="Type" (selectionChange)="marginTypeChange()" formControlName="marginType">
                                    <mat-option *ngFor="let marginType of marginTypeDataSource" [value]="marginType.value">
                                        {{marginType.text
    }}
    </mat-option>
    </mat-select>
    </mat-form-field>
    </div>
    <div class="col-9 text-right font-weight-bold" *ngIf="currentPrice && [0,1].indexOf(data.marginType) > -1">
        <h5 style="font-weight: 400;">{{currentPrice.product}}: {{currentPrice.price | currency:'USD'}}</h5>
    </div>
    </div>
    <div class="row mt-2" style="border-top: 1px solid; border-top-style: outset;">
        <div class="col">
            <h5>Price Tiers</h5>
        </div>
    </div>
    <div class="row mb-2">
        <div class="col">
            <table class="mat-table" style="min-width: 75%;">
                <thead>
                    <tr class="mat-header-row">
                        <th class="text-center mat-header-cell text-lg-center">Min. (gal)</th>
                        <th class="text-center mat-header-cell text-lg-center">Margin</th>
                        <th class="text-center mat-header-cell">All-in</th>
                        <th class="text-center mat-header-cell">
                            <button ni-button size="small" [view]="'accent'" beforeIcon="fa fa-plus" (click)="addCustomerMargin()">Add New</button>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let customerMargin of data.customerMargins" class="mat-row mat-row-not-hover">
                        <td class="mat-cell text-center">
                            <mat-form-field class="col-4">
                                <input matInput class="text-lg-right" (keyup.enter)="fixCustomerMargins()" (blur)="fixCustomerMargins()" [(ngModel)]="customerMargin.min" [ngModelOptions]="{standalone: true}" />
                            </mat-form-field>
                        </td>
                        <td class="mat-cell text-center">
                            <div>
                                <mat-form-field class="col-4">
                                    <input matInput class="text-lg-right" [(ngModel)]="customerMargin.amount" [ngModelOptions]="{standalone: true}" (focus)="onFocus()" (focusout)="outFocus()"  (keyup)="onType(customerMargin,$event)" (blur)="customerMarginAmountChanged(customerMargin)"   currencyMask [options]="{prefix: '$', thousands: ',', decimal: '.'}" />
                                </mat-form-field>

                            </div>
                        </td>
                        <td class="mat-cell text-center font-weight-bold font-italic text-right">
                            <div>{{customerMargin.itp | currency:'USD'}}</div>
                        </td>
                        <td class="text-right mat-cell">
                            <button ni-button [view]="'error'" size="small" beforeIcon="fa fa-trash" (click)="deleteCustomerMargin(customerMargin)">Delete</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    </div>
    <div class="text-right mt-2">
        <button mat-button [mat-dialog-close]="">Cancel</button>
        <button mat-button (click)="stepper.reset()">Reset</button>
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button matStepperNext>Next</button>
    </div>
    </form>
    </mat-step>
    <mat-step [stepControl]="thirdFormGroup">
        <form [formGroup]="thirdFormGroup">
            <ng-template matStepLabel>Create Email</ng-template>
            <div class="container-fluid inner-content">
                <div class="row mt-2 mb-2">
                    <div class="col">
                        <mat-form-field>
                            <input matInput placeholder="Subject" formControlName="subject" [(ngModel)]="data.subject" aria-label="Subject" autocomplete="off" />
                        </mat-form-field>
                    </div>
                </div>
                <div class="row mt-2 mb-2" style="font-size:0.8rem;">
                    <span class="font-weight-bold" style="font-size:1rem;">
                        Notes</span>  &nbsp;&nbsp;&nbsp; To show to all FuelerLinx customers
                </div>
                <div class="row mt-2 mb-2">
                    <div class="col">
                        <ejs-richtexteditor #typeNotes id='rteNotes' [toolbarSettings]='{enable:false}' [(value)]='data.notes'></ejs-richtexteditor>
                    </div>
                </div>
                <div class="row mt-2 mb-2" style="font-size:0.8rem;">
                    <span class="font-weight-bold" style="font-size:1rem;">
                        Email
                    </span> &nbsp;&nbsp;&nbsp;  The body of the email to accompany your distribution emails
                </div>
                <div class="row mt-2 mb-2">
                    <div class="col">
                        <ejs-richtexteditor #typeEmail id='rteEmail' (focusout)="enableToolbarEmail()" (focus)="disableToolbarEmail()" [(value)]='data.email'></ejs-richtexteditor>
                    </div>
                </div>
            </div>
                <div class="text-right mt-2">
                    <button mat-button [mat-dialog-close]="">Cancel</button>
                    <button mat-button matStepperPrevious>Back</button>
                    <button mat-button (click)="addTemplateClicked()">Add Template</button>
                </div>
</form>
    </mat-step>
    </mat-horizontal-stepper>
    </div>
